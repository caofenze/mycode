(function(){function d(j,l,a){if(j.length===+j.length){for(var b=0,k=j.length;b<k;b++){if(l.call(a,b,j[b],j)===false){return}}}else{for(var i in j){if(j.hasOwnProperty(i)){if(l.call(a,i,j[i],j)===false){return}}}}}var c=function(b,f){this._render_start=b.render_start;this._data=b;this._render_timing={ht:0,vt:0,drt:0,tti:0,lt:0,fvt:0,crt:0};this._conf=f||{log_path:"http://static.tieba.baidu.com/tb/pms/img/st.gif",img_conn_path:"http://xs.tieba.baidu.com/cache_monitor",display:false};if(window.PDC&&PDC._opt.log_path){this._conf.log_path=PDC._opt.log_path}this._performance_timing={};this._metrics=[];d(b.timing,function(h,e){this._render_timing[h]=e},this);var a=this;if(document.attachEvent){window.attachEvent("onbeforeunload",function(){a._unload_send()})}else{window.addEventListener("beforeunload",function(){a._unload_send()},false)}this._measureScreen();this._browser();this._measureNetworkTime();this._measureRenderTime();this._speicalParams();this._ready()};c.prototype._speicalParams=function(){var a=window.PDC&&PDC._opt&&PDC._opt.s_params;if(a){d(a,function(b,f){this._metrics.push("cus_"+b+"="+f)},this)}};c.prototype._ready=function(){this.send()};c.prototype._measureScreen=function(){if(window.screen){this._metrics.push("_screen="+window.screen.width+"*"+window.screen.height+"|"+window.screen.availWidth+"*"+window.screen.availHeight)}};c.prototype.getFPT=function(){var a;if(window.performance&&performance.timing&&performance.timing.msFirstPaint){a=performance.timing.msFirstPaint}else{if(window.chrome&&chrome.loadTimes){a=parseInt(chrome.loadTimes().firstPaintTime*1000)}}return a};c.prototype._measureNetworkTime=function(){var h={};var g=0;if(window.performance&&performance.timing){var a=performance.timing;g=a.domainLookupStart;h.dns=a.domainLookupEnd;h.ct=a.connectEnd;h.st=a.responseStart;h.tt=a.responseEnd;h.dct=a.domComplete;h.olt=a.loadEventEnd;if(this.getFPT()){h.nfpt=this.getFPT()}var b=PDC._render_start-a.navigationStart;b>0&&this._metrics.push("wtt="+b)}this._measureTime(g,h)};c.prototype._measureTime=function(b,a){var f=0;d(a,function(h,e){f=(""+e).length<8?e:e-b;this._metrics.push(h+"="+f)},this)};c.prototype._measureRenderTime=function(){if(window.performance&&window.performance.timing){var a=window.performance.timing;this._performance_timing=a;this._render_timing.lt=a.loadEventStart;if(a.loadEventEnd>0){this._render_timing.let=a.loadEventEnd}}if(this.getFPT()){this._render_timing.fpt=this.getFPT()}if(this._render_timing.fvt==0){this._render_timing.fvt=this._render_timing.crt=this._render_timing.let}this._measureTime(this._render_start,this._render_timing)};c.prototype._browser=function(){var b=this._uaMatch(navigator.userAgent);var h=b.browser;if(h=="msie"){if(document.documentMode){var a=b.version.substring(0,1);if(window.performance){h+="9.0";this._metrics.push("ebrowser="+a+"9"+document.documentMode)}else{h+="8.0";this._metrics.push("ebrowser="+a+"8"+document.documentMode)}}else{h+=b.version}}var g={"msie6.0":16,"msie7.0":17,"msie8.0":18,"msie9.0":19,chrome:20,mozilla:30,safari:40,opera:50};this._metrics.push("browser="+(g[h]||0))};c.prototype._uaMatch=function(o){var a=/(chrome)\/(\d+\.\d)/,m=/(\d+\.\d)?(?:\.\d)?\s+safari\/?(\d+\.\d+)?/,p=/(opera)(?:.*version)?[ \/]([\w.]+)/,n=/(msie) ([\w.]+)/,l=/(mozilla)(?:.*? rv:([\w.]+))?/,o=o.toLowerCase(),k={};var b=a.exec(o)||p.exec(o)||n.exec(o)||o.indexOf("compatible")<0&&l.exec(o)||[];if(m.test(o)&&!/chrome/.test(o)){b[1]="safari";b[2]=RegExp["$1"]||RegExp["$2"]}return{browser:b[1]||"unknown",version:b[2]||"0"}};c.prototype.send=function(){if(c._is_send){return}c._is_send=true;var a=this._data.env,h=this._metrics,g=this._connection_num;d(a,function(f,e){h.push(f+"="+e)});if(window._trace_page_logid){h.push("logid="+_trace_page_logid)}h.push("pf="+navigator.platform);h.push("_t="+new Date()*1);var b=document.createElement("img");b.src=this._conf.log_path+"?"+h.join("&");window["___pms_img_"+new Date()*1]=b};c.prototype._unload_send=function(){if(c._is_unload_send){return}c._is_unload_send=true;var a=this._data.env,j=[];if(window.F&&F.fisMark){var i=this._render_start,b=[];d(F.fisMark,function(f,e){var g=[];d(e,function(m,n){g.push('"'+m+'":'+(n-i))},this);b.push('"'+f+'":{'+g.join(",")+"}")},this);j.push("fis_timing={"+b.join(",")+"}")}if(j.length>0){d(a,function(f,e){j.push(f+"="+e)});var h=document.createElement("img");h.src=this._conf.log_path+"?"+j.join("&");window["___pms_img_"+new Date()*1]=h}};if(!window.WPO_PDA){window.WPO_PDA=new c(PDC.metadata())}})();